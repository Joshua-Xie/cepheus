{
  "name": "vagrant",
  "json_class": "Chef::Environment",
  "description": "Data to build out local Cepheus Cluster",
  "cookbook_versions": {},
  "chef_type": "environment",
  "override_attributes": {
    "cepheus": {
      "environment": "vagrant",
      "method": "repo",
      "repo": {
        "packages": [
          {"name": "", "version": "", "pin": true}
        ]
      },
      "development": {
          "enabled": false,
          "user": "vagrant"
      },
      "cron": {
        "logs": {
            "enable": false,
            "radosgw": {
                "uid": "cepheus_log_admin",
                "name": "Cepheus Log Admin",
                "access_key": "whatever_your_access_key",
                "secret_key": "whatever_your_secret_key",
                "endpoint": "whatever_your_endpoint",
                "port": 80,
                "bucket": "cepheus_logs"
            },
            "patterns": [
                {"directory": "/var/log/ceph", "pattern": "*.log-*.gz", "bucket":"cepheus_logs"},
                {"directory": "/var/log/radosgw", "pattern": "ceph.client.radosgw.*.log-*.gz", "bucket":"cepheus_logs"},
                {"directory": "/var/log/radosgw", "pattern": "civetweb.access.*.log-*.gz", "bucket":"cepheus_logs"}
            ]
        },
        "radosgw": {
            "stats": {
                "user": "vagrant",
                "minute": "/30",
                "command": "/usr/local/bin/radosgw-stats.sh"
            }
        }
      },
      "bootstrap": {
        "name": "ceph-bootstrap",
        "env": "/home/vagrant/cepheus/environments",
        "interfaces": [
          {"name": "enp0s8", "ip": "10.0.100.20", "netmask": "255.255.255.0", "gateway": "", "mac": ""},
          {"name": "enp0s9", "ip": "10.121.2.2", "netmask": "255.255.255.0", "gateway": "", "mac": ""}
        ]
      },

      "adc": {
        "enable": true, 
        "tag": "ceph-adc",
        "interface": "enp0s8",
        "bond": {
          "enable": false,
          "name": "bond0",
          "type": "Bond",
          "mtu": 1500,
          "interfaces": ["enp0s8","enp0s8"],
          "options": "mode=1 miimon=100 fail_over_mac=1",
          "nm_controlled": "no"
        },
        "stats": {
            "enable": true, 
            "user": "haproxy",
            "passwd": "haproxy",
            "port": 1936
        },
        "connections": {
          "max": 1000,
          "balance": "roundrobin"
        },

        "ssl": {
          "path": "/etc/ssl/private"
        },
        "vip": {
          "prefix": "10.121.16.16",
          "netmask": "255.255.255.240",
          "cidr": 28,
          "port": {
            "ssl": 443,
            "non_ssl": 80
          }
        },
        "vips": [
          {"name": "www", "ip": "10.121.16.20", "cidr": 28, "interface": "enp0s8", "backend_label": "web-ui-backend", "ssl": false, "cert": "wildcard.s3.www.example.com.pem", "ssl_files": ["wildcard.s3.www.example.com.pem"], "url": "www.example.com"},
          {"name": "api", "ip": "10.121.16.19", "cidr": 28, "interface": "enp0s8", "backend_label": "restful-api-backend", "ssl": false, "cert": "wildcard.s3.api.example.com.pem", "ssl_files": ["wildcard.s3.api.example.com.pem"], "url": "api.example.com"},
          {"name": "dev", "ip": "10.121.16.18", "cidr": 28, "interface": "enp0s8", "backend_label": "radosgw-http-backend", "ssl": false, "cert": "wildcard.s3.vagrant.dev.example.com.pem", "ssl_files": ["wildcard.s3.vagrant.dev.example.com.pem"], "url": "s3.vagrant.dev.example.com"},
          {"name": "prod", "ip": "10.121.16.17", "cidr": 28, "interface": "enp0s8", "backend_label": "radosgw-http-backend", "ssl": false, "cert": "wildcard.s3.vagrant.prod.example.com.pem", "ssl_files": ["wildcard.s3.vagrant.prod.example.com.pem"], "url": "s3.vagrant.prod.example.com"}
        ],
        "bgp": {
          "enable": false,
          "asn": 65001,
          "interface": "enp0s8",
          "roles": [
            {"name": "ceph-vm1", "role": "primary"},
            {"name": "ceph-vm2", "role": "secondary"}
          ],
          "peers": [
              {"name": "Spine1", "label": "bgp_peer1", "ip": "10.121.16.8"},
              {"name": "Spine2", "label": "bgp_peer2", "ip": "10.121.16.9"}
          ]
        },
        "backend": {
          "servers": [
            {"name": "ceph-vm1", "instance": "", "type": "rgw", "weight": "6", "port": 8080, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm2", "instance": "", "type": "rgw", "weight": "6", "port": 8080, "options": "check inter 2s rise 2 fall 3"},
            {"name": "ceph-vm3", "instance": "", "type": "rgw", "weight": "6", "port": 8080, "options": "check inter 2s rise 2 fall 3"}
          ]
        },

        "keepalived": {
          "enable": true, 
          "passwd": "keepalived",
          "checks": true, 
          "servers": [
            {"name": "ceph-vm3", "weight": "5", "interface": "enp0s8", "priority": 90},
            {"name": "ceph-vm2", "weight": "5", "interface": "enp0s8", "priority": 100},
            {"name": "ceph-vm1", "weight": "5", "interface": "enp0s8", "priority": 110}
          ]
        }
      },

      "chef": {
        "owner": "vagrant",
        "group": "vagrant"
      },
      "security": {
        "sshd": {
          "permit_root_login": "no",
          "login_grace_time": "2m",
          "max_auth_tries": 6,
          "max_sessions": 10,
          "banner": "/etc/banner"
        },
        "firewall": {
          "enable":false,
          "zone": "public",
          "use": "rules",
          "rules": [
            {"name": "ceph", "type": "rich-rule", "zone": "public", "permanent": true, "roles": ["ceph-mon","ceph-osd","ceph-rgd","ceph-rgw","ceph-mds","ceph-admin","ceph-restapi","ceph-adc"], "rules": ["rule family='ipv4' source address='10.0.100.0/24' accept","rule family='ipv4' source address='10.0.100.0/24' service name='ssh' accept"]}
          ],
          "interfaces": [
            {
              "name": "public",
              "ports": [
                {"role": "ceph-bootstrap", "open": [{"port": 123, "protocol": "udp"}, {"port": 80, "protocol": "tcp"}, {"port": 443, "protocol": "tcp"}, {"port": 67, "protocol": "udp"}, {"port": 69, "protocol": "udp"}, {"port": 21, "protocol": "tcp"}, {"port": 4011, "protocol": "udp"}, {"port": 53, "protocol": "udp"}], "ranges": [{"start": 25150, "end": 25152, "protocol": "tcp"}]},
                {"role": "ceph-mon", "open": [{"port": 6789, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-osd", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]},
                {"role": "ceph-rgw", "open": [8080], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-restapi", "open": [{"port": 5080, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-admin", "open": [], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "ceph-mds", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]},
                {"role": "ceph-rbd", "open": [], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "haproxy", "open": [{"port": 80, "protocol": "tcp"}, {"port": 443, "protocol": "tcp"},{"port": 1936, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]},
                {"role": "keepalived", "open": [{"port": 112, "protocol": "tcp"}], "ranges": [{"start": 0, "end": 0, "protocol": "tcp"}]}
              ]
            },
            {
              "name": "cluster",
              "ports": [
                {"role": "ceph-osd", "open": [], "ranges": [{"start": 6800, "end": 6872, "protocol": "tcp"}]}
              ]
            }
          ]
        }
      },
      "system": {
        "scheduler": {
            "device": {
                "enable": true,
                "type": "cfq",
                "ceph": {
                    "class": "idle",
                    "priority": 7
                },
                "devices": [
                      "sdb",
                      "sdc",
                      "sdd",
                      "sde"
                ]
            }
        },
        "sysctl": {
            "enable": true,
            "sysctls": [
              "kernel.pid_max=4194303",
              "fs.file-max=26234859",
              "net.core.rmem_max=67108864",
              "net.core.wmem_max=67108864",
              "net.core.rmem_default=33554432",
              "net.core.wmem_default=33554432",
              "net.ipv4.tcp_rmem=\"16777216 33554432 67108864\"",
              "net.ipv4.tcp_wmem=\"16777216 33554432 67108864\"",
              "net.core.optmem_max=33554432"
            ]
        }
      },
      "ipmi": {
        "user": "",
        "passwd": ""
      },

      "servers": [
            {"name": "ceph-boostrap",
            "roles": ["bootstrap"],
            "profile": "",
            "interfaces": [
                    {"profile": "public", "interface": "enp0s3", "mac": "08:00:27:E3:84:01", "ip": "10.0.100.20", "netmask": "255.255.255.0", "gateway": "10.0.100.2", "mtu": 1500},
                    {"profile": "cluster", "interface": "enp0s8", "mac": "08:00:27:3E:CB:B0", "ip": "10.121.2.3", "netmask": "255.255.255.0", "gateway": "10.121.2.2", "mtu": 1500}
            ]},
            {"name": "ceph-vm1",
            "roles": ["mon","osd","rgw","adc","admin"],
            "profile": "ceph_non_osd_node",
            "interfaces": [
                    {"profile": "public", "interface": "enp0s3", "mac": "08:00:27:E3:84:01", "ip": "10.0.100.21", "netmask": "255.255.255.0", "gateway": "10.0.100.2", "mtu": 1500},
                    {"profile": "cluster", "interface": "enp0s8", "mac": "08:00:27:3E:CB:B0", "ip": "10.121.2.3", "netmask": "255.255.255.0", "gateway": "10.121.2.2", "mtu": 1500}
            ]},
            {"name": "ceph-vm2",
            "roles": ["mon","osd","rgw","adc","admin"],
            "profile": "ceph_non_osd_node",
            "interfaces": [
                    {"profile": "public", "interface": "enp0s3", "mac": "08:00:27:EB:EC:61", "ip": "10.0.100.22", "netmask": "255.255.255.0", "gateway": "10.0.100.2", "mtu": 1500},
                    {"profile": "cluster", "interface": "enp0s8", "mac": "08:00:27:C5:9F:40", "ip": "10.121.2.4", "netmask": "255.255.255.0", "gateway": "10.121.2.2", "mtu": 1500}
            ]},
            {"name": "ceph-vm3",
            "roles": ["mon","osd","rgw","adc","admin"],
            "profile": "ceph_non_osd_node",
            "interfaces": [
                    {"profile": "public", "interface": "enp0s3", "mac": "08:00:27:8B:9F:3F", "ip": "10.0.100.23", "netmask": "255.255.255.0", "gateway": "10.0.100.2", "mtu": 1500},
                    {"profile": "cluster", "interface": "enp0s8", "mac": "08:00:27:1B:3B:E7", "ip": "10.121.2.5", "netmask": "255.255.255.0", "gateway": "10.121.2.2", "mtu": 1500}
            ]}
      ],

      "primary_user": {
        "name": "vagrant",
        "passwd": "$6$Salt$6AyUczFy6SgV8A2wKAKfA9drpzrUsTGPJ3QjcWBbgS97BxBO.C7ZcBFALRiRkKfi9x8MK2SHet38BCQWS9LsR/",
        "passwd_type": "--iscrypted",
        "key": "ceph_bootstrap.pub",
        "shell": "/bin/bash",
        "comment": "Vagrant user",
        "groups": "wheel",
        "sudo":true
      },
      "users": [
            {
            "name": "operations", "group": "wheel", "comment": "Operations user", "passwd": "$6$Salt$3xxLPT099nzTbWkOS3CPNcar/zSLQ8BEgZdJk/AOkOb4V80sPepbraWcvrJvEEu6PswpKUw1WodWeiqRo1bw2/",
            "passwd_type": "--iscrypted", "key": "ceph_bootstrap.pub", "private_key": "operations",
            "sudo": true, "ceph_group": true
            },
            {
            "name": "vagrant", "group": "wheel", "comment": "Vagrant user", "passwd": "$6$Salt$6AyUczFy6SgV8A2wKAKfA9drpzrUsTGPJ3QjcWBbgS97BxBO.C7ZcBFALRiRkKfi9x8MK2SHet38BCQWS9LsR/",
            "passwd_type": "--iscrypted", "key": "ceph_bootstrap.pub", "private_key": "operations",
            "sudo": true, "ceph_group": true
            }
      ],

      
      "os": {
        "type": "centos",
        "name": "centos-7.2",
        "version": "7.2",
        "arch": "x86_64",
        "distro": "centos-7-x86_64-minimal.iso",
        "breed": "redhat"
      },
      "ceph": {
        "cluster": "ceph",
        "repo": {
          "create": true, 
          "version": {
            "name": "luminous",
            "number": "10.2.6",
            "branch": "stable",
            "revision": "0.el7",
            "arch": "x86_64"
          }
        },
        "mgr": {
          "enable": false
        },
        "config": {
          "global": {
            "rgw override bucket index max shards": 5
          },
          "mon": {
            "mon osd full ratio": 0.95,
            "mon osd nearfull ratio": 0.85,
            "mon pg warn max per osd": 0,
            "mon pg warn max object skew": 10,
            "mon osd min down reporters": 3,
            "mon osd down out interval": 600,
            "clock drift allowed": 0.15
          },
          "radosgw": {
            "cache max file size": 20000000
          }
        },
        "mon": {
          "port": 6789,
          "niceness": -10,
          "bond": {
            "enable": false,
            "name": "bond0",
            "type": "Bond",
            "mtu": 1500,
            "interfaces": ["enp0s8","enp0s8"],
            "options": "mode=1 miimon=100 fail_over_mac=1",
            "nm_controlled": "no"
          }

        },
        "radosgw": {
          "port": 8080,
          "default_url": "ceph-vm1.example.com",
          "debug": {
            "logs": {
              "level": 2,
              "enable": true 
            }
          },
          "logs": {
            "ops": true, 
            "usage": true 
          },
          "gc": {
            "max_objects": 64,
            "obj_min_wait": 3600,
            "processor_max_time": 1800,
            "processor_period": 1800
          },
          "users": [
              {"uid": "radosgw", "name": "Admin", "email": "", "admin_caps": "users=*;buckets=*;metadata=*;usage=*;zone=*", "access_key": "", "secret_key": "", "max_buckets": 0, "status": "enable", "key_type": "s3", "quota": {"user": { "status": "disable", "size": -1, "objects": -1 }, "buckets": [{"name": "fill_test", "status": "disable", "size": -1, "objects": -1}]}, "zones": [], "buckets": ["fill_test"]},
              {"uid": "cepheus_log_admin", "name": "Ceheus Log Admin", "email": "", "admin_caps": "", "access_key": "", "secret_key": "", "max_buckets": 0, "status": "enable", "key_type": "s3", "quota": {"user": { "status": "disable", "size": -1, "objects": -1 }, "buckets": [{"name": "cepheus_logs", "status": "disable", "size": -1, "objects": -1}]}, "zones": [], "buckets": ["cepheus_logs"]},
              {"uid": "tester", "name": "Tester", "email": "", "admin_caps": "usage=read; user=read; bucket=*", "access_key": "", "secret_key": "", "max_buckets": 3, "status": "enable", "key_type": "s3", "quota": {"user": { "status": "enable", "size": 10, "objects": -1 }, "buckets": []}, "zones": [], "buckets": []}
          ],
          "keystone": {
            "auth": false,
            "admin": {
              "token": "",
              "url": "",
              "port": 35357
            },
            "accepted_roles": "admin Member _member_",
            "token_cache_size": 1000,
            "revocation_interval": 1200
          },
          "rgw_num_rados_handles": 5,
          "civetweb_num_threads": 100,
          "bond": {
            "enable": false,
            "name": "bond0",
            "type": "Bond",
            "mtu": 1500,
            "interfaces": ["enp0s8","enp0s8"],
            "options": "mode=1 miimon=100 fail_over_mac=1",
            "nm_controlled": "no"
          }
        },
        "osd": {
          "devices": [
                {"data": "/dev/sdb", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "encrypted": false},
                {"data": "/dev/sdc", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "encrypted": false},
                {"data": "/dev/sdd", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "encrypted": false},
                {"data": "/dev/sde", "data_type": "hdd", "journal": "/dev/sdf", "journal_type": "ssd", "encrypted": false}
          ],
          "crush": {
            "update": false,
            "update_on_start": true, 
            "chooseleaf_type": 1
          },
          "add": [],
          "remove": [],
          "niceness": -10,
          "rebalance": false,
          "size": {
            "max": 3,
            "min": 2
          },
          "journal": {
            "size": 3000
          }
        },
        "pools": {
          "active": ["radosgw"],
          "crush": {
            "rule": 1
          },
          "erasure_coding": {
            "profiles": [
              {"profile": "cepheus", "directory": "/usr/lib64/ceph/erasure-code", "plugin": "jerasure", "force": true, "technique": "reed_sol_van", "ruleset_root": "hdd", "ruleset_failure_domain": "host", "key_value": {"k": 2, "m": 1}}
            ]
          },
          "radosgw": {
            "federated": {
              "enable": false,
              "multisite_replication": false,
              "zone_instances": [
                  {"name": "dev", "port": 8080, "region": "local", "url": "s3.vagrant.dev.example.com", "rgw_thread_pool": 100, "handles": 5, "threads": 100},
                  {"name": "prod", "port": 8081, "region": "local", "url": "s3.vagrant.prod.example.com", "rgw_thread_pool": 100, "handles": 5, "threads": 100}
              ],
              "regions": ["local"],
              "enable_regions_zones": false,
              "master_zone": "dev",
              "master_zone_port": 8080
            },
            "pools": [
                  {"name": ".log", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".intent-log", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw.control", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw.gc", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw.root", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw.buckets", "data_percent": 95.90, "type": "erasure", "profile": "cepheus", "crush_ruleset": 1, "crush_ruleset_name": "hdd"},
                  {"name": ".rgw.buckets.index", "data_percent": 2.00, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".rgw.buckets.extra", "data_percent": 1.00, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".users", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".users.uid", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".users.email", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".users.swift", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"},
                  {"name": ".usage", "data_percent": 0.10, "type": "replicated", "profile": "", "crush_ruleset": 0, "crush_ruleset_name": "hdd_replicated"}
            ],
            "settings": {
              "pg_num": 64,
              "pgp_num": 64,
              "options": "",
              "force": false,
              "calc": true, 
              "size": 3,
              "crush_ruleset": 1,
              "chooseleaf": "host",
              "chooseleaf_type": 1,
              "type": "erasure",
              "nodes_per_rack": 1
            },
            "remove": {
              "names": []
            }
          },
          "pgs": {
            "calc": {
              "total_osds": 12,
              "target_pgs_per_osd": 200,
              "min_pgs_per_pool": 64,
              "replicated_size": 3,
              "erasure_size": 3
            },
            "num": 64
          }
        },
        "restapi": {
          "url": "api.example.com",
          "ip": "10.121.1.21",
          "port": 5080
        }
      },
      "domain_name" : "example.com",
      "network": {
        "public": {
          "interface": "enp0s8",
          "cidr": [
            "10.0.100.0/24"
          ],
          "mtu": 1500
        },
        "cluster": {
          "interface": "enp0s9",
          "gateway_enable": false,
          "cidr": [
            "10.121.2.0/24"
          ],
          "route": {
            "cidr": ""
          },
          "mtu": 1500
        }
      },
      "dns": {
        "servers": ["8.8.8.8", "8.8.4.4"]
      },
      "ntp": {
        "servers": ["0.pool.ntp.org", "1.pool.ntp.org", "2.pool.ntp.org", "3.pool.ntp.org"]
      },
      "collectd-plugins": {
        "write_graphite": {
          "node": {
            "id": "graphite",
            "host": "127.0.0.1",
            "port": 2013,
            "prefix": "collectd."
          }
        }
      },
      "zabbix": {
        "repository": "http://repo.zabbix.com/zabbix/2.4/rhel/7/x86_64/",
        "repository_key": "file:///etc/pki/rpm-gpg/RPM-GPG-KEY-ZABBIX",
        "server": "10.0.100.6",
        "ceph": {
         "blocked_op": 0,
         "slow_osd": 0
        }
      }
    },
    "chef_client": {
      "server_url": "http://10.0.100.20:4000",
      "cache_path": "/var/chef/cache",
      "backup_path": "/var/chef/backup",
      "validation_client_name": "cepheus-validator",
      "run_path": "/var/chef"
    }
  }
}